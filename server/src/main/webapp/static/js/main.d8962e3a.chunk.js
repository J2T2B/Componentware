(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{29:function(e,t,a){},36:function(e,t,a){e.exports=a(53)},41:function(e,t,a){},53:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),r=a(31),i=a.n(r),o=(a(41),a(6)),c=a(8),l=a(11),h=a(9),u=a(10),d=(a(42),a(71)),m=a(72),p=a(73),f=a(74),v=a(63),g=a(62),w=a(75),E=a(76),b=a(13),C=a(33),y=a(58),k=a(59),O=a(60),j=a(61),M=a(54),A=a(55),S=a(56),L=a(57),N=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).interval=0,a.state={lastMessageDifference:""},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.interval=window.setInterval(this.setDifference.bind(this),6e4)}},{key:"componentDidUpdate",value:function(e,t){t.messageId!==this.props.chat.getLastMessage().id&&this.setDifference()}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.interval)}},{key:"setCurrentChat",value:function(){this.props.chatsHandler.currentChat=this.props.chat}},{key:"setDifference",value:function(){var e=this.props.chat.getLastMessage();e&&this.setState({lastMessageDifference:e.created.fromNow(),messageId:e.id})}},{key:"render",value:function(){var e=this.props.chat.getLastMessage(),t=null===e?"Keine Nachricht":e.text,a=this.props.chat.unreadMessages,n=s.a.createElement(s.a.Fragment,null);return a>0&&(n=s.a.createElement(M.a,{color:"primary",pill:!0},a),t=s.a.createElement("strong",null,t)),s.a.createElement(A.a,{onClick:this.setCurrentChat.bind(this),active:this.props.chatsHandler.currentChat===this.props.chat},s.a.createElement("div",{className:"d-flex w-100 justify-content-between"},s.a.createElement(S.a,null,this.props.chat.partner.name),s.a.createElement("small",null,this.state.lastMessageDifference)),s.a.createElement(L.a,{className:"d-flex w-100 justify-content-between"},t,n))}}]),t}(s.a.Component),I=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={chats:[],currentChat:void 0},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"onCurrentChatChange",value:function(e){this.setState({currentChat:e})}},{key:"onChatChange",value:function(e){this.setState({chats:e})}},{key:"componentDidMount",value:function(){this.props.chatsHandler.attach(this)}},{key:"componentWillUnmount",value:function(){this.props.chatsHandler.detatch(this)}},{key:"render",value:function(){var e=this;return this.props.isOpen?s.a.createElement(y.a,null,s.a.createElement(k.a,null,s.a.createElement(O.a,null,"William Walker")),s.a.createElement(j.a,null,this.state.chats.map((function(t){return s.a.createElement(N,{chat:t,key:t.chatId,chatsHandler:e.props.chatsHandler})})))):s.a.createElement(s.a.Fragment,null)}}]),t}(s.a.Component),x=a(16),H=a.n(x),P=a(18);function T(e){return"object"===typeof e&&void 0!==e.onChatChange}function F(e){return"object"===typeof e&&void 0!==e.onChatChange&&void 0!==e.onMessage}var _=function(){function e(t){Object(o.a)(this,e),this.messages=void 0,this.partner=void 0,this.chatId=void 0,this.chatId=t.chatId,this.partner=t.partner,this.messages=[]}return Object(c.a)(e,[{key:"addMessage",value:function(e){this.messages=this.messages.sort((function(e,t){return t.created.unix()-e.created.unix()})),this.messages.push(e)}},{key:"getLastMessage",value:function(){return this.messages.length>0?this.messages[this.messages.length-1]:null}},{key:"unreadMessages",get:function(){var e=0;return this.messages.forEach((function(t){t.userHasRead||e++})),e}}]),e}(),W=a(20),D=a.n(W),R=function e(t){Object(o.a)(this,e),this.id=void 0,this.text=void 0,this.image=void 0,this.isAnswer=void 0,this.answers=void 0,this.userHasRead=void 0,this.created=void 0,this.id=t.id,this.text=t.text,this.image=t.image,this.isAnswer=t.isAnswer,this.answers=t.answers,this.userHasRead=t.userHasRead,this.created=D()(t.created).locale("de")},z=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(){var e=Object(P.a)(H.a.mark((function e(){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.simulateMessage=this.simulateMessage.bind(this),console.log("Globale Funktion simulateMessage(...) hinzugef\xfcgt"),window.setTimeout(this.quereMessage.bind(this),2e3),e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e){console.log("Nachricht an Server",e)}},{key:"simulateMessage",value:function(e){var t=this;Array.isArray(e)?e.forEach((function(e){return t.onSocketMessage(e)})):this.onSocketMessage(e)}},{key:"quereMessage",value:function(){for(var e=0;e<5;e++){this.simulateMessage({command:"CreateChat",chat:{chatId:e,partner:{name:"Kunde "+(e+1),imageUrl:"http://emilcarlsson.se/assets/harveyspecter.png"},messages:[]}});for(var t=0;t<10;t++){var a=Math.random()<.5,n=[];if(!a)for(var s=4*Math.random()+1,r=0;r<s;r++)n.push({id:10*t+r,text:"Antwort "+t+r});this.simulateMessage({command:"AddMessage",chatId:e,message:{id:(10*e+t).toString(),text:"Hallo Will "+(10*e+t).toString(),image:"",answers:n,userHasRead:!1,created:(new Date).getTime()-99999999,isAnswer:a}})}}}}]),t}(function(){function e(){Object(o.a)(this,e),this.chatsListener=void 0,this.chatListener=void 0,this.chats=void 0,this._currentChat=void 0,this.chatListener=[],this.chatsListener=[],this.chats=[]}return Object(c.a)(e,[{key:"attach",value:function(e){F(e)?this.chatListener.push(e):T(e)&&this.chatsListener.push(e)}},{key:"detatch",value:function(e){F(e)?this.chatListener=this.detatchListener(e,this.chatListener):T(e)&&(this.chatsListener=this.detatchListener(e,this.chatsListener))}},{key:"submitAnswer",value:function(e){var t;t="number"===typeof e?e:e.id,this.sendMessage({command:"SubmitAnswer",answerId:t})}},{key:"readAllMessages",value:function(){var e=this;if(void 0===this._currentChat)throw new Error("No current Chat.");var t=this._currentChat.messages.filter((function(e){return!e.userHasRead})),a=!0,n=!1,s=void 0;try{for(var r,i=t[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var o=r.value;o.userHasRead=!0,this.sendMessage({command:"ReadMessage",messageId:o.id})}}catch(c){n=!0,s=c}finally{try{a||null==i.return||i.return()}finally{if(n)throw s}}this.chatsListener.forEach((function(t){return t.onChatChange(e.chats)}))}},{key:"detatchListener",value:function(e,t){return t.filter((function(t){return t!==e}))}},{key:"onMessage",value:function(e,t){var a=this,n=new R(t);if(void 0!==this._currentChat&&e===this._currentChat.chatId)this._currentChat.addMessage(n),this.chatListener.forEach((function(e){return e.onMessage(a._currentChat,n)}));else{var s=this.chats.find((function(t){return t.chatId===e}));if(void 0===s)throw new Error("Chat ".concat(e," not found. Fatal Error"));s.addMessage(n)}var r=new Audio("eventually.mp3");r.play().then((function(){return r.remove()})),this.chatsListener.forEach((function(e){return e.onChatChange(a.chats)}))}},{key:"onAnswer",value:function(e,t,a){var n=this,s=this.chats.find((function(t){return t.chatId===e}));if(void 0===s)throw new Error("Chat ".concat(e," not found. Fatal Error"));var r=s.messages.find((function(e){return e.id===t}));if(void 0===r)throw new Error("Message ".concat(t," on Chat ").concat(e," not found. Fatal Error"));r.answers.push(a),void 0!==this._currentChat&&this._currentChat.chatId===e&&this.chatListener.forEach((function(e){return e.onMessage(n._currentChat,r)}))}},{key:"onSocketMessage",value:function(e){var t=this;switch(e.command){case"CreateChat":this.chats.push(new _(e.chat)),this.chatsListener.forEach((function(e){return e.onChatChange(t.chats)}));break;case"AddMessage":this.onMessage(e.chatId,e.message);break;case"AddAnswer":this.onAnswer(e.chatId,e.messageId,e.answer);break;default:throw new Error("The Command ".concat(e.command," is unknown"))}}},{key:"currentChat",get:function(){return this._currentChat},set:function(e){var t=this;this._currentChat=e,void 0!==e&&(this.readAllMessages(),this.chatListener.forEach((function(e){return e.onChatChange(t._currentChat)}))),this.chatsListener.forEach((function(e){return e.onCurrentChatChange(t._currentChat)}))}}]),e}()),B=a(7),U=a(23),V=a(25),K=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).messagesEnd=void 0,a.state={chat:void 0,openAnswers:!1},a.openAnswers=a.openAnswers.bind(Object(B.a)(a)),a.onAnswerChoose=a.onAnswerChoose.bind(Object(B.a)(a)),a.onSendMessage=a.onSendMessage.bind(Object(B.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"onChatChange",value:function(e){this.setState({chat:e})}},{key:"onMessage",value:function(e,t){this.setState({chat:e})}},{key:"scrollToBottom",value:function(){this.messagesEnd.scrollIntoView({behavior:"smooth"})}},{key:"componentDidMount",value:function(){this.props.chatsHandler.attach(this),this.scrollToBottom()}},{key:"componentWillUnmount",value:function(){this.props.chatsHandler.detatch(this),this.scrollToBottom()}},{key:"openAnswers",value:function(){var e=this.state.chat.getLastMessage().answers[0];if(this.setState((function(e){return{openAnswers:!e.openAnswers}})),void 0===this.state.chosenAnswer){var t=void 0===e?void 0:e.id;this.setState({chosenAnswer:t})}}},{key:"onAnswerChoose",value:function(e){this.setState({chosenAnswer:e,openAnswers:!1})}},{key:"onSendMessage",value:function(){var e=this;if(void 0!==this.state.chosenAnswer){console.log(this.state.chosenAnswer);var t=this.state.chat.getLastMessage().answers.find((function(t){return t.id===e.state.chosenAnswer}));console.log("sending answer ("+t.id+"): "+t.text)}else console.log("no answer chosen.")}},{key:"render",value:function(){var e=this;return void 0===this.state.chat?s.a.createElement(g.a,null,s.a.createElement("div",{className:"contact-profile"},s.a.createElement("img",{className:"contact-picture"}),s.a.createElement("div",{className:"contact-name"},s.a.createElement("em",null,"Kein Chat ausgew\xe4hlt"))),s.a.createElement("div",{className:"messages col-md-12"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"message"},s.a.createElement("em",null,"Keine Nachrichten"))),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))):s.a.createElement(g.a,null,s.a.createElement("div",{className:"contact-profile"},s.a.createElement("img",{className:"contact-picture",src:this.state.chat.partner.imageUrl,alt:this.state.chat.partner.name}),s.a.createElement("div",{className:"contact-name"},this.state.chat.partner.name)),s.a.createElement("div",{className:"messages col-md-12"},this.state.chat&&this.state.chat.messages.map((function(e){return s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"message"},s.a.createElement("div",{className:"bubble"+(e.isAnswer?" reply":" receive")},s.a.createElement("p",null,e.text),s.a.createElement("p",{className:"time"},e.created.isBefore(D()().startOf("day"))&&e.created.format("L"),"\xa0",e.created.format("HH:mm")))))})),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}),this.state.openAnswers&&this.state.chat.getLastMessage()?s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-1"},"\xa0"),s.a.createElement("div",{className:"col-md-10"},s.a.createElement(j.a,null,this.state.chat.getLastMessage().answers.map((function(t){return s.a.createElement(A.a,{tag:"button",className:e.state.chosenAnswer===t.id?"active":"",onClick:function(){return e.onAnswerChoose(t.id)},id:"answer-"+t.id},t.text)})))),s.a.createElement("div",{className:"col-md-1"},"\xa0")):""),s.a.createElement("div",{className:"message-input"},s.a.createElement("div",{className:"row text-center"},s.a.createElement("div",{className:"col-md-1"},s.a.createElement(v.a,null,s.a.createElement(U.a,{icon:V.b}))),s.a.createElement("div",{className:"col-md-10"},s.a.createElement("div",{className:"form-control",onClick:this.openAnswers},this.state.chat.getLastMessage().isAnswer?"":this.state.chosenAnswer?this.state.chat.getLastMessage().answers.find((function(t){return t.id===e.state.chosenAnswer})).text:s.a.createElement("i",null,"Bitte Antwort w\xe4hlen"))),s.a.createElement("div",{className:"col-md-1"},s.a.createElement(v.a,{color:"primary",onClick:this.onSendMessage},s.a.createElement(U.a,{icon:V.a}))))))}}]),t}(s.a.Component),q=(a(29),a(64)),J=a(65),G=a(66),$=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={width:window.innerWidth},a.onSizeChange=a.onSizeChange.bind(Object(B.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.onSizeChange(),document.getElementsByTagName("body")[0].classList.add("login-register-background"),window.addEventListener("resize",this.onSizeChange)}},{key:"componentWillUnmount",value:function(){document.getElementsByTagName("body")[0].classList.remove("login-register-background"),window.removeEventListener("resize",this.onSizeChange)}},{key:"onSizeChange",value:function(){this.setState({width:window.innerWidth})}},{key:"render",value:function(){return s.a.createElement(y.a,{className:this.state.width>992?"mx-auto w-50":"mx-auto",style:{backdropFilter:"blur(10px)",backgroundColor:"#FFFFFF88"}},s.a.createElement(q.a,null,s.a.createElement(O.a,null,s.a.createElement("h5",{className:""},"login"===this.props.mode&&"Anmelden","register"===this.props.mode&&"Registrieren"))),s.a.createElement(k.a,null,s.a.createElement(J.a,null,s.a.createElement(v.a,{color:"primary",active:"login"===this.props.mode,href:"#/login",tag:"a"},"Anmelden"),s.a.createElement(v.a,{color:"primary",active:"register"===this.props.mode,href:"#/register",tag:"a"},"Registrieren")),s.a.createElement(G.a,null,this.props.children)))}}]),t}(s.a.Component),Q=a(67),X=a(68),Y=a(69),Z=a(70);function ee(e){return s.a.createElement(Q.a,null,s.a.createElement(X.a,null,e.label),s.a.createElement(Y.a,{type:e.type,placeholder:e.placeholder,value:e.value,name:e.name,onChange:(t=e.onValue,function(e){var a=e.target,n={};n[a.name]=a.value,t(n)}),invalid:void 0!==e.error,autoComplete:e.autoComplete}),void 0!==e.error&&s.a.createElement(Z.a,null,e.error));var t}var te=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={username:"",password:""},a.onInput=a.onInput.bind(Object(B.a)(a)),a.onSubmit=a.onSubmit.bind(Object(B.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"onInput",value:function(e){this.setState(e)}},{key:"onSubmit",value:function(){var e=Object(P.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={username:this.state.username,password:this.state.password},console.log("Login mit",t);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement($,{mode:"login"},s.a.createElement(ee,{label:"Username",onValue:this.onInput,name:"username",placeholder:"william.walker1",value:this.state.username,type:"text",autoComplete:"username"}),s.a.createElement(ee,{label:"Passwort",onValue:this.onInput,name:"password",placeholder:"132456789",value:this.state.password,type:"password",autoComplete:"current-password"}),s.a.createElement(v.a,{onClick:this.onSubmit,color:"success",disabled:0===this.state.username.length||0===this.state.password.length},"Anmelden"))}}]),t}(s.a.Component),ae={usernameToShort:"Nutzername darf nicht leer sein",passwordToShort:"Passwort darf nicht leer sein",passwordMatch:"Passw\xf6rter stimmen nicht \xfcberein"},ne=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={name:"William Walker",username:"",usernameError:ae.usernameToShort,password:"",passwordError:ae.passwordToShort,repeatPassword:""},a.onInput=a.onInput.bind(Object(B.a)(a)),a.onSubmit=a.onSubmit.bind(Object(B.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"onInput",value:function(e){e.repeatPasswordError=void 0,e.passwordError=void 0,e.usernameError=void 0,(void 0!==e.password&&e.password!==this.state.repeatPassword||void 0!==e.repeatPassword&&e.repeatPassword!==this.state.password)&&(e.repeatPasswordError=ae.passwordMatch),void 0!==e.password&&e.password.length<1&&(e.passwordError=ae.passwordToShort),void 0!==e.username&&e.username.length<1&&(e.usernameError=ae.usernameToShort),this.setState(e)}},{key:"onSubmit",value:function(){var e=Object(P.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={username:this.state.username,password:this.state.password},console.log("Register with ",t);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement($,{mode:"register"},s.a.createElement(Q.a,null,s.a.createElement(X.a,null,"Name"),s.a.createElement(Y.a,{type:"text",value:this.state.name,autoComplete:"off",readOnly:!0})),s.a.createElement(ee,{label:"Username",name:"username",placeholder:"william.walker",value:this.state.username,type:"text",onValue:this.onInput,error:this.state.usernameError,autoComplete:"username"}),s.a.createElement(ee,{onValue:this.onInput,label:"Passwort",name:"password",placeholder:"12345678",value:this.state.password,type:"password",error:this.state.passwordError,autoComplete:"new-password"}),s.a.createElement(ee,{onValue:this.onInput,label:"Passwort wiederholen",name:"repeatPassword",placeholder:"12345678",value:this.state.repeatPassword,type:"password",error:this.state.repeatPasswordError,autoComplete:"new-password"}),s.a.createElement(v.a,{color:"success",onClick:this.onSubmit,disabled:!se(this.state.repeatPasswordError,this.state.passwordError,this.state.usernameError)},"Registrieren"))}}]),t}(s.a.Component);function se(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];for(var n=0,s=t;n<s.length;n++){if(void 0!==s[n])return!1}return!0}var re=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).chatsHandler=void 0,a.chatsHandler=new z,a.chatsHandler.connect(),a.state={isChatListOpen:!0},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"toggleChatsList",value:function(){this.setState((function(e){return{isChatListOpen:!e.isChatListOpen}}))}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(d.a,{color:"faded",dark:!0,className:"mb-3"},s.a.createElement(m.a,{href:"/",className:"mr-auto"},"Telekilo"),s.a.createElement(p.a,null,s.a.createElement(f.a,{className:"d-md-none"},s.a.createElement(v.a,{color:"primary",onClick:this.toggleChatsList.bind(this)},"Chatliste")))),s.a.createElement(g.a,{fluid:!0},s.a.createElement(C.a,null,s.a.createElement(b.c,null,s.a.createElement(b.a,{path:"/",exact:!0},s.a.createElement(w.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(I,{chatsHandler:this.chatsHandler,isOpen:this.state.isChatListOpen})),s.a.createElement(E.a,{md:8},s.a.createElement(K,{chatsHandler:this.chatsHandler})))),s.a.createElement(b.a,{path:"/login",exact:!0,render:function(){return s.a.createElement(te,{chatsHandler:e.chatsHandler})}}),s.a.createElement(b.a,{path:"/register",exact:!0,render:function(){return s.a.createElement(ne,{chatsHandler:e.chatsHandler})}})))))}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(52);i.a.render(s.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[36,1,2]]]);
//# sourceMappingURL=main.d8962e3a.chunk.js.map